<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pants of Horus Guild Cluster</title>
  <link rel="stylesheet" href="global.css">
</head>
<body>
  <h1>Pants of Horus Guild Cluster</h1>
  <div class="guild-container" id="guildContainer">
    <!-- Guilds dynamically populated here -->
  </div>
  <a href="https://discord.gg/pantsofhorus" target="_blank" class="discord-button">Join PoH Discord</a>
  <script>
    // Your guild data is directly included in the HTML
    const guildData = {
      "guilds": [
        {
          "name": "Thunder Warriors",
          "logo": "https://static.wikia.nocookie.net/warhammer40k/images/f/f9/Raptor_Imperialis_Icon.png"
        },
        {
          "name": "Word Bearers",
          "logo": "https://d1w82usnq70pt2.cloudfront.net/wp-content/uploads/2022/08/gh-word-bearers-icon.png"
        },
        {
          "name": "Salamanders",
          "logo": "https://d1w82usnq70pt2.cloudfront.net/wp-content/uploads/2022/03/gh-salamanders-icon-e1646502293159.png"
        },
        {
          "name": "Luna Wolves",
          "logo": "emblems/lw.png"
        },
        {
          "name": "Ultramarines",
          "logo": "https://d1w82usnq70pt2.cloudfront.net/wp-content/uploads/2022/03/gh-ultramarines-icon.png"
        },
        {
          "name": "Blood Angels",
          "logo": "https://d1w82usnq70pt2.cloudfront.net/wp-content/uploads/2022/03/gh-blood-angels-icon.png"
        },
        {
          "name": "Alpha Legion",
          "logo": "https://d1w82usnq70pt2.cloudfront.net/wp-content/uploads/2022/09/gh-alpha-legion-icon.png"
        },
        {
          "name": "Iron Hands",
          "logo": "https://d1w82usnq70pt2.cloudfront.net/wp-content/uploads/2022/03/gh-iron-hands-icon.png"
        },
        {
          "name": "Imperial Fists",
          "logo": "https://d1w82usnq70pt2.cloudfront.net/wp-content/uploads/2022/03/gh-imperial-fists-icon.png"
        },
        {
          "name": "Death Guard",
          "logo": "https://wh40k.lexicanum.com/mediawiki/images/thumb/9/97/Deathguardsymbol.png/200px-Deathguardsymbol.png"
        },
        {
          "name": "Space Sharks",
          "logo": "emblems/ss.png"
        },
        {
          "name": "Emperors Children",
          "logo": "https://wh40k.lexicanum.com/mediawiki/images/thumb/2/22/Emperorschildren.png/200px-Emperorschildren.png"
        },
        {
          "name": "White Scars",
          "logo": "https://d1w82usnq70pt2.cloudfront.net/wp-content/uploads/2022/03/gh-white-scars-icon.png"
        },
        {
          "name": "Night Lords",
          "logo": "https://d1w82usnq70pt2.cloudfront.net/wp-content/uploads/2022/09/gh-night-lords-icon-300x300.png"
        },
        {
          "name": "Grey Knights",
          "logo": "emblems/gk.png"
        },
        {
          "name": "Space Wolves",
          "logo": "https://d1w82usnq70pt2.cloudfront.net/wp-content/uploads/2022/03/gh-space-wolves-icon.png"
        },
        {
          "name": "World Eaters",
          "logo": "https://d1w82usnq70pt2.cloudfront.net/wp-content/uploads/2022/11/GH_icons_WorldEaters_HH.png"
        }
      ]
    };

    let data = [
    {
        "_sa_instance_state": "<sqlalchemy.orm.state.InstanceState object at 0x7fa1ced48a00>",
        "GuildName": "Alpha Legion",
        "DiscordID": "664611713311571983",
        "EmojiID": "<:AlphaLegion:1069003322570309752>",
        "MinimumLevel": 43,
        "MaxMember": 30,
        "Edited": 1,
        "LastSeasonRank": 189,
        "CurrentMember": 30,
        "ProjectedLoss": 1
    },
    {
        "_sa_instance_state": "<sqlalchemy.orm.state.InstanceState object at 0x7fa1cece8040>",
        "GuildName": "Blood Angels",
        "DiscordID": "664611713311571983",
        "EmojiID": "<:BloodAngels:1069003325195948153>",
        "MinimumLevel": 44,
        "MaxMember": 30,
        "Edited": 1,
        "LastSeasonRank": 42,
        "CurrentMember": 30,
        "ProjectedLoss": 1
    },
    {
        "_sa_instance_state": "<sqlalchemy.orm.state.InstanceState object at 0x7fa1cece80a0>",
        "GuildName": "Death Guard",
        "DiscordID": "664611713311571983",
        "EmojiID": "<:DeathGuard:1069003332028473384>",
        "MinimumLevel": 35,
        "MaxMember": 30,
        "Edited": 1,
        "LastSeasonRank": 103,
        "CurrentMember": 30,
        "ProjectedLoss": 0
    },
    {
        "_sa_instance_state": "<sqlalchemy.orm.state.InstanceState object at 0x7fa1cece8100>",
        "GuildName": "Emperors Children",
        "DiscordID": "664611713311571983",
        "EmojiID": "<:EmperorsChildren:1069003335241310248>",
        "MinimumLevel": 40,
        "MaxMember": 30,
        "Edited": 1,
        "LastSeasonRank": 84,
        "CurrentMember": 30,
        "ProjectedLoss": 0
    },
    {
        "_sa_instance_state": "<sqlalchemy.orm.state.InstanceState object at 0x7fa1cece8160>",
        "GuildName": "Grey Knights",
        "DiscordID": "664611713311571983",
        "EmojiID": "<:greyknights:1181310592548622396>",
        "MinimumLevel": 35,
        "MaxMember": 30,
        "Edited": 1,
        "LastSeasonRank": 201,
        "CurrentMember": 30,
        "ProjectedLoss": 0
    },
    {
        "_sa_instance_state": "<sqlalchemy.orm.state.InstanceState object at 0x7fa1cece81c0>",
        "GuildName": "Imperial Fists",
        "DiscordID": "664611713311571983",
        "EmojiID": "<:ImperialFists:1069003337275560037>",
        "MinimumLevel": 40,
        "MaxMember": 30,
        "Edited": 1,
        "LastSeasonRank": 73,
        "CurrentMember": 30,
        "ProjectedLoss": 0
    },
    {
        "_sa_instance_state": "<sqlalchemy.orm.state.InstanceState object at 0x7fa1cece8220>",
        "GuildName": "Iron Hands",
        "DiscordID": "664611713311571983",
        "EmojiID": "<:IronHands:1069003342975619122>",
        "MinimumLevel": 40,
        "MaxMember": 30,
        "Edited": 1,
        "LastSeasonRank": 90,
        "CurrentMember": 30,
        "ProjectedLoss": 0
    },
    {
        "_sa_instance_state": "<sqlalchemy.orm.state.InstanceState object at 0x7fa1cece8280>",
        "GuildName": "Luna Wolves",
        "DiscordID": "664611713311571983",
        "EmojiID": "<:LunaWolves:1069003494129938472>",
        "MinimumLevel": 42,
        "MaxMember": 30,
        "Edited": 1,
        "LastSeasonRank": 21,
        "CurrentMember": 30,
        "ProjectedLoss": 0
    },
    {
        "_sa_instance_state": "<sqlalchemy.orm.state.InstanceState object at 0x7fa1cece82e0>",
        "GuildName": "Night Lords",
        "DiscordID": "664611713311571983",
        "EmojiID": "<:NightLords:1069003350462443631>",
        "MinimumLevel": 48,
        "MaxMember": 30,
        "Edited": 1,
        "LastSeasonRank": 55,
        "CurrentMember": 30,
        "ProjectedLoss": 0
    },
    {
        "_sa_instance_state": "<sqlalchemy.orm.state.InstanceState object at 0x7fa1cece8340>",
        "GuildName": "Salamanders",
        "DiscordID": "664611713311571983",
        "EmojiID": "<:salamanders:1069003355512377487>",
        "MinimumLevel": 48,
        "MaxMember": 30,
        "Edited": 1,
        "LastSeasonRank": 19,
        "CurrentMember": 29,
        "ProjectedLoss": 1
    },
    {
        "_sa_instance_state": "<sqlalchemy.orm.state.InstanceState object at 0x7fa1cece83a0>",
        "GuildName": "Space Sharks",
        "DiscordID": "664611713311571983",
        "EmojiID": "<:spacesharks:1181310557148676207>",
        "MinimumLevel": 16,
        "MaxMember": 29,
        "Edited": 1,
        "LastSeasonRank": 985,
        "CurrentMember": 29,
        "ProjectedLoss": 1
    },
    {
        "_sa_instance_state": "<sqlalchemy.orm.state.InstanceState object at 0x7fa1cece8400>",
        "GuildName": "Space Wolves",
        "DiscordID": "664611713311571983",
        "EmojiID": "<:SpaceWolves:1069003362172940309>",
        "MinimumLevel": 40,
        "MaxMember": 30,
        "Edited": 1,
        "LastSeasonRank": 101,
        "CurrentMember": 26,
        "ProjectedLoss": 1
    },
    {
        "_sa_instance_state": "<sqlalchemy.orm.state.InstanceState object at 0x7fa1cece8460>",
        "GuildName": "Thunder Warriors",
        "DiscordID": "664611713311571983",
        "EmojiID": "<:ThunderWarriors:1125540345216778272>",
        "MinimumLevel": 50,
        "MaxMember": 30,
        "Edited": 1,
        "LastSeasonRank": 8,
        "CurrentMember": 29,
        "ProjectedLoss": 0
    },
    {
        "_sa_instance_state": "<sqlalchemy.orm.state.InstanceState object at 0x7fa1cece84c0>",
        "GuildName": "Ultramarines",
        "DiscordID": "664611713311571983",
        "EmojiID": "<:ultramarines:1069003367843643502>",
        "MinimumLevel": 40,
        "MaxMember": 30,
        "Edited": 1,
        "LastSeasonRank": 62,
        "CurrentMember": 30,
        "ProjectedLoss": 0
    },
    {
        "_sa_instance_state": "<sqlalchemy.orm.state.InstanceState object at 0x7fa1cece8520>",
        "GuildName": "White Scars",
        "DiscordID": "664611713311571983",
        "EmojiID": "<:WhiteScars:1069003372851634226>",
        "MinimumLevel": 38,
        "MaxMember": 30,
        "Edited": 1,
        "LastSeasonRank": 43,
        "CurrentMember": 30,
        "ProjectedLoss": 0
    },
    {
        "_sa_instance_state": "<sqlalchemy.orm.state.InstanceState object at 0x7fa1cece8580>",
        "GuildName": "Word Bearers",
        "DiscordID": "664611713311571983",
        "EmojiID": "<:WordBearers:1069003376777515130>",
        "MinimumLevel": 50,
        "MaxMember": 30,
        "Edited": 1,
        "LastSeasonRank": 9,
        "CurrentMember": 30,
        "ProjectedLoss": 0
    },
    {
        "_sa_instance_state": "<sqlalchemy.orm.state.InstanceState object at 0x7fa1cece85e0>",
        "GuildName": "World Eaters",
        "DiscordID": "664611713311571983",
        "EmojiID": "<:WorldEaters:1069003378794958900>",
        "MinimumLevel": 30,
        "MaxMember": 30,
        "Edited": 1,
        "LastSeasonRank": 832,
        "CurrentMember": 28,
        "ProjectedLoss": 0
    }
];
    let apiData = [];

    const apiUrl = 'https://ahrimanapi-1-k2332593.deta.app/DiscordOpenings/664611713311571983';
    fetch(apiUrl, {
      method: "GET", // *GET, POST, PUT, DELETE, etc.
      mode: "cors", // no-cors, *cors, same-origin
      origin: "https://pantsofhorus.com",
      headers: {
        "Content-Type": "application/json",
        "Access-Control-Allow-Origin": "*",
      },
     })
      .then(response => {
        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`);
        }
        return response.json();
      })
      .then(data => {
        apidata = data;
      })
      .catch(error => {
        console.error('Fetch error:', error);
      });

    // function extractGuildFields(guild) {
    //     return {
    //         GuildName: guild.GuildName || "",
    //         LastSeasonRanking: guild.LastSeasonRank || 0,
    //         MaxMembers: guild.MaxMember || 0,
    //         CurrentMembers: guild.CurrentMember || 0,
    //         MinimumLevel: guild.MinimumLevel || 0,
    //         ProjectedLosses: guild.ProjectedLoss || 0,
    //     };
    // }

    document.addEventListener('DOMContentLoaded', () => {
      const guildContainer = document.getElementById('guildContainer');
      
      // const guilds = apiData.map(extractGuildFields);
      console.log(apiData);
      const guilds = apiData;
      guilds.sort((a,b) => a.LastSeasonRanking - b.LastSeasonRanking);
      guilds.forEach(guild => {
        const guildItem = document.createElement('div');
        guildItem.className = 'guild-item';
        guildItem.innerHTML = `
          <div class="guild-title-wrapper">
            <h2 class="guild-title">${guild.GuildName}</h2>
            <p class="guild-subtitle">TOP ${guild.LastSeasonRanking} (L-${guild.MinimumLevel})</p>
          </div>
          <img class="guild-logo" src="${guildData.guilds.find(({name}) => name === guild.GuildName)?.logo}" alt="${guild.GuildName} Logo">
          <p class="recruiting">${(guild.CurrentMember < guild.MaxMembers) || guild.ProjectedLosses > 0 ? 'Currently recruiting!' : ''}</p>
        `;
        guildContainer.appendChild(guildItem);
      })

    });
  </script>
</body>
</html>
