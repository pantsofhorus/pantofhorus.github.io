<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pants of Horus Guild Cluster</title>
  <link rel="stylesheet" href="global.css">
</head>
<body>
  <h1>Pants of Horus Guild Cluster</h1>
  <div class="guild-container" id="guildContainer">
    <!-- Guilds dynamically populated here -->
  </div>
  <a href="https://discord.gg/pantsofhorus" target="_blank" class="discord-button">Join PoH Discord</a>
  <script>
    // Your guild data is directly included in the HTML
    const guildData = {
      "guilds": [
        {
          "name": "Thunder Warriors",
          "logo": "https://static.wikia.nocookie.net/warhammer40k/images/f/f9/Raptor_Imperialis_Icon.png"
        },
        {
          "name": "Word Bearers",
          "logo": "https://d1w82usnq70pt2.cloudfront.net/wp-content/uploads/2022/08/gh-word-bearers-icon.png"
        },
        {
          "name": "Salamanders",
          "logo": "https://d1w82usnq70pt2.cloudfront.net/wp-content/uploads/2022/03/gh-salamanders-icon-e1646502293159.png"
        },
        {
          "name": "Luna Wolves",
          "logo": "emblems/lw.png"
        },
        {
          "name": "Ultramarines",
          "logo": "https://d1w82usnq70pt2.cloudfront.net/wp-content/uploads/2022/03/gh-ultramarines-icon.png"
        },
        {
          "name": "Blood Angels",
          "logo": "https://d1w82usnq70pt2.cloudfront.net/wp-content/uploads/2022/03/gh-blood-angels-icon.png"
        },
        {
          "name": "Alpha Legion",
          "logo": "https://d1w82usnq70pt2.cloudfront.net/wp-content/uploads/2022/09/gh-alpha-legion-icon.png"
        },
        {
          "name": "Iron Hands",
          "logo": "https://d1w82usnq70pt2.cloudfront.net/wp-content/uploads/2022/03/gh-iron-hands-icon.png"
        },
        {
          "name": "Imperial Fists",
          "logo": "https://d1w82usnq70pt2.cloudfront.net/wp-content/uploads/2022/03/gh-imperial-fists-icon.png"
        },
        {
          "name": "Death Guard",
          "logo": "https://wh40k.lexicanum.com/mediawiki/images/thumb/9/97/Deathguardsymbol.png/200px-Deathguardsymbol.png"
        },
        {
          "name": "Space Sharks",
          "logo": "emblems/ss.png"
        },
        {
          "name": "Emperors Children",
          "logo": "https://wh40k.lexicanum.com/mediawiki/images/thumb/2/22/Emperorschildren.png/200px-Emperorschildren.png"
        },
        {
          "name": "White Scars",
          "logo": "https://d1w82usnq70pt2.cloudfront.net/wp-content/uploads/2022/03/gh-white-scars-icon.png"
        },
        {
          "name": "Night Lords",
          "logo": "https://d1w82usnq70pt2.cloudfront.net/wp-content/uploads/2022/09/gh-night-lords-icon-300x300.png"
        },
        {
          "name": "Grey Knights",
          "logo": "emblems/gk.png"
        },
        {
          "name": "Space Wolves",
          "logo": "https://d1w82usnq70pt2.cloudfront.net/wp-content/uploads/2022/03/gh-space-wolves-icon.png"
        },
        {
          "name": "World Eaters",
          "logo": "https://d1w82usnq70pt2.cloudfront.net/wp-content/uploads/2022/11/GH_icons_WorldEaters_HH.png"
        }
      ]
    };

    let data = "[\n    {\n        \"_sa_instance_state\": \"<sqlalchemy.orm.state.InstanceState object at 0x7ff7302bf040>\",\n        \"LastSeasonRank\": 189,\n        \"EmojiID\": \"<:AlphaLegion:1069003322570309752>\",\n        \"CurrentMember\": 30,\n        \"ProjectedLoss\": 1,\n        \"GuildName\": \"Alpha Legion\",\n        \"DiscordID\": \"664611713311571983\",\n        \"MinimumLevel\": 43,\n        \"MaxMember\": 30,\n        \"Edited\": 1\n    },\n    {\n        \"_sa_instance_state\": \"<sqlalchemy.orm.state.InstanceState object at 0x7ff7302bf0a0>\",\n        \"LastSeasonRank\": 42,\n        \"EmojiID\": \"<:BloodAngels:1069003325195948153>\",\n        \"CurrentMember\": 30,\n        \"ProjectedLoss\": 1,\n        \"GuildName\": \"Blood Angels\",\n        \"DiscordID\": \"664611713311571983\",\n        \"MinimumLevel\": 44,\n        \"MaxMember\": 30,\n        \"Edited\": 1\n    },\n    {\n        \"_sa_instance_state\": \"<sqlalchemy.orm.state.InstanceState object at 0x7ff7302bf100>\",\n        \"LastSeasonRank\": 103,\n        \"EmojiID\": \"<:DeathGuard:1069003332028473384>\",\n        \"CurrentMember\": 30,\n        \"ProjectedLoss\": 0,\n        \"GuildName\": \"Death Guard\",\n        \"DiscordID\": \"664611713311571983\",\n        \"MinimumLevel\": 35,\n        \"MaxMember\": 30,\n        \"Edited\": 1\n    },\n    {\n        \"_sa_instance_state\": \"<sqlalchemy.orm.state.InstanceState object at 0x7ff7302bf160>\",\n        \"LastSeasonRank\": 84,\n        \"EmojiID\": \"<:EmperorsChildren:1069003335241310248>\",\n        \"CurrentMember\": 30,\n        \"ProjectedLoss\": 0,\n        \"GuildName\": \"Emperors Children\",\n        \"DiscordID\": \"664611713311571983\",\n        \"MinimumLevel\": 40,\n        \"MaxMember\": 30,\n        \"Edited\": 1\n    },\n    {\n        \"_sa_instance_state\": \"<sqlalchemy.orm.state.InstanceState object at 0x7ff7302bf1c0>\",\n        \"LastSeasonRank\": 201,\n        \"EmojiID\": \"<:greyknights:1181310592548622396>\",\n        \"CurrentMember\": 30,\n        \"ProjectedLoss\": 0,\n        \"GuildName\": \"Grey Knights\",\n        \"DiscordID\": \"664611713311571983\",\n        \"MinimumLevel\": 35,\n        \"MaxMember\": 30,\n        \"Edited\": 1\n    },\n    {\n        \"_sa_instance_state\": \"<sqlalchemy.orm.state.InstanceState object at 0x7ff7302bf220>\",\n        \"LastSeasonRank\": 73,\n        \"EmojiID\": \"<:ImperialFists:1069003337275560037>\",\n        \"CurrentMember\": 30,\n        \"ProjectedLoss\": 0,\n        \"GuildName\": \"Imperial Fists\",\n        \"DiscordID\": \"664611713311571983\",\n        \"MinimumLevel\": 40,\n        \"MaxMember\": 30,\n        \"Edited\": 1\n    },\n    {\n        \"_sa_instance_state\": \"<sqlalchemy.orm.state.InstanceState object at 0x7ff7302bf280>\",\n        \"LastSeasonRank\": 90,\n        \"EmojiID\": \"<:IronHands:1069003342975619122>\",\n        \"CurrentMember\": 30,\n        \"ProjectedLoss\": 0,\n        \"GuildName\": \"Iron Hands\",\n        \"DiscordID\": \"664611713311571983\",\n        \"MinimumLevel\": 40,\n        \"MaxMember\": 30,\n        \"Edited\": 1\n    },\n    {\n        \"_sa_instance_state\": \"<sqlalchemy.orm.state.InstanceState object at 0x7ff7302bf2e0>\",\n        \"LastSeasonRank\": 21,\n        \"EmojiID\": \"<:LunaWolves:1069003494129938472>\",\n        \"CurrentMember\": 30,\n        \"ProjectedLoss\": 0,\n        \"GuildName\": \"Luna Wolves\",\n        \"DiscordID\": \"664611713311571983\",\n        \"MinimumLevel\": 42,\n        \"MaxMember\": 30,\n        \"Edited\": 1\n    },\n    {\n        \"_sa_instance_state\": \"<sqlalchemy.orm.state.InstanceState object at 0x7ff7302bf340>\",\n        \"LastSeasonRank\": 55,\n        \"EmojiID\": \"<:NightLords:1069003350462443631>\",\n        \"CurrentMember\": 30,\n        \"ProjectedLoss\": 0,\n        \"GuildName\": \"Night Lords\",\n        \"DiscordID\": \"664611713311571983\",\n        \"MinimumLevel\": 48,\n        \"MaxMember\": 30,\n        \"Edited\": 1\n    },\n    {\n        \"_sa_instance_state\": \"<sqlalchemy.orm.state.InstanceState object at 0x7ff7302bf3a0>\",\n        \"LastSeasonRank\": 19,\n        \"EmojiID\": \"<:salamanders:1069003355512377487>\",\n        \"CurrentMember\": 29,\n        \"ProjectedLoss\": 1,\n        \"GuildName\": \"Salamanders\",\n        \"DiscordID\": \"664611713311571983\",\n        \"MinimumLevel\": 48,\n        \"MaxMember\": 30,\n        \"Edited\": 1\n    },\n    {\n        \"_sa_instance_state\": \"<sqlalchemy.orm.state.InstanceState object at 0x7ff7302bf400>\",\n        \"LastSeasonRank\": 985,\n        \"EmojiID\": \"<:spacesharks:1181310557148676207>\",\n        \"CurrentMember\": 29,\n        \"ProjectedLoss\": 1,\n        \"GuildName\": \"Space Sharks\",\n        \"DiscordID\": \"664611713311571983\",\n        \"MinimumLevel\": 16,\n        \"MaxMember\": 29,\n        \"Edited\": 1\n    },\n    {\n        \"_sa_instance_state\": \"<sqlalchemy.orm.state.InstanceState object at 0x7ff7302bf460>\",\n        \"LastSeasonRank\": 101,\n        \"EmojiID\": \"<:SpaceWolves:1069003362172940309>\",\n        \"CurrentMember\": 26,\n        \"ProjectedLoss\": 1,\n        \"GuildName\": \"Space Wolves\",\n        \"DiscordID\": \"664611713311571983\",\n        \"MinimumLevel\": 40,\n        \"MaxMember\": 30,\n        \"Edited\": 1\n    },\n    {\n        \"_sa_instance_state\": \"<sqlalchemy.orm.state.InstanceState object at 0x7ff7302bf4c0>\",\n        \"LastSeasonRank\": 8,\n        \"EmojiID\": \"<:ThunderWarriors:1125540345216778272>\",\n        \"CurrentMember\": 29,\n        \"ProjectedLoss\": 0,\n        \"GuildName\": \"Thunder Warriors\",\n        \"DiscordID\": \"664611713311571983\",\n        \"MinimumLevel\": 50,\n        \"MaxMember\": 30,\n        \"Edited\": 1\n    },\n    {\n        \"_sa_instance_state\": \"<sqlalchemy.orm.state.InstanceState object at 0x7ff7302bf520>\",\n        \"LastSeasonRank\": 62,\n        \"EmojiID\": \"<:ultramarines:1069003367843643502>\",\n        \"CurrentMember\": 30,\n        \"ProjectedLoss\": 0,\n        \"GuildName\": \"Ultramarines\",\n        \"DiscordID\": \"664611713311571983\",\n        \"MinimumLevel\": 40,\n        \"MaxMember\": 30,\n        \"Edited\": 1\n    },\n    {\n        \"_sa_instance_state\": \"<sqlalchemy.orm.state.InstanceState object at 0x7ff7302bf580>\",\n        \"LastSeasonRank\": 43,\n        \"EmojiID\": \"<:WhiteScars:1069003372851634226>\",\n        \"CurrentMember\": 30,\n        \"ProjectedLoss\": 0,\n        \"GuildName\": \"White Scars\",\n        \"DiscordID\": \"664611713311571983\",\n        \"MinimumLevel\": 38,\n        \"MaxMember\": 30,\n        \"Edited\": 1\n    },\n    {\n        \"_sa_instance_state\": \"<sqlalchemy.orm.state.InstanceState object at 0x7ff7302bf5e0>\",\n        \"LastSeasonRank\": 9,\n        \"EmojiID\": \"<:WordBearers:1069003376777515130>\",\n        \"CurrentMember\": 30,\n        \"ProjectedLoss\": 0,\n        \"GuildName\": \"Word Bearers\",\n        \"DiscordID\": \"664611713311571983\",\n        \"MinimumLevel\": 50,\n        \"MaxMember\": 30,\n        \"Edited\": 1\n    },\n    {\n        \"_sa_instance_state\": \"<sqlalchemy.orm.state.InstanceState object at 0x7ff7302bf640>\",\n        \"LastSeasonRank\": 832,\n        \"EmojiID\": \"<:WorldEaters:1069003378794958900>\",\n        \"CurrentMember\": 27,\n        \"ProjectedLoss\": 0,\n        \"GuildName\": \"World Eaters\",\n        \"DiscordID\": \"664611713311571983\",\n        \"MinimumLevel\": 30,\n        \"MaxMember\": 30,\n        \"Edited\": 1\n    }\n]";
    const apiData = JSON.parse(data);

    const apiUrl = 'https://ahrimanapi-1-k2332593.deta.app/DiscordOpenings/664611713311571983';
    fetch(apiUrl, {
      method: "GET", // *GET, POST, PUT, DELETE, etc.
      mode: "cors", // no-cors, *cors, same-origin
      origin: "https://pantsofhorus.com",
      headers: {
        "Content-Type": "application/json",
        "Access-Control-Allow-Origin": "*",
      },
     })
      .then(response => {
        console.log(response)
        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`);
        }
        return response.json();
      })
      .then(data => {
        console.log(data)
        // Data is the parsed JSON response from the API
        apidata = data.map(extractGuildFields);
      })
      .catch(error => {
        console.error('Fetch error:', error);
      });

    function extractGuildFields(guild) {
        return {
            GuildName: guild.GuildName || "",
            LastSeasonRanking: guild.LastSeasonRank || 0,
            MaxMembers: guild.MaxMember || 0,
            CurrentMembers: guild.CurrentMember || 0,
            MinimumLevel: guild.MinimumLevel || 0,
            ProjectedLosses: guild.ProjectedLoss || 0,
        };
    }

    document.addEventListener('DOMContentLoaded', () => {
      const guildContainer = document.getElementById('guildContainer');
      
      const guilds = apiData.map(extractGuildFields);
      guilds.sort((a,b) => a.LastSeasonRanking - b.LastSeasonRanking);
      guilds.forEach(guild => {
        const guildItem = document.createElement('div');
        guildItem.className = 'guild-item';
        guildItem.innerHTML = `
          <div class="guild-title-wrapper">
            <h2 class="guild-title">${guild.GuildName}</h2>
            <p class="guild-subtitle">TOP ${guild.LastSeasonRanking} (L-${guild.MinimumLevel})</p>
          </div>
          <img class="guild-logo" src="${guildData.guilds.find(({name}) => name === guild.GuildName)?.logo}" alt="${guild.GuildName} Logo">
          <p class="recruiting">${(guild.CurrentMember < guild.MaxMembers) || guild.ProjectedLosses > 0 ? 'Currently recruiting!' : ''}</p>
        `;
        guildContainer.appendChild(guildItem);
      })

    });
  </script>
</body>
</html>
